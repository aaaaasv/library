{% extends 'bookshelf/base.html' %}
{% block title %} Library {% endblock %}
{% block search %}
    <button class="btn btn-outline-info my-3 my-sm-0"><a href="{% url 'index' %}">Show all books</a></button>
    <form method="get" class="form-inline my-2 my-lg-0">
        <select name="filterstatus" aria-labelledby="navbarDropdown" class="btn btn-outline-info">
            <option value="" disabled selected>Filter Book Status</option>
            <option value='A'
                    style="background-color:transparent; border:none; cursor:pointer" ; color:black;
                    class="filter-button">Available
            </option>
            <option value='N'
                    style="background-color:transparent; border:none; cursor:pointer; color:black"
                    class=" filter-button">Not Available
            </option>
        </select>
        <input class="form-control mr-sm-2 searchfield" id="searchbox" name="search" type="search"
               value="{{ request.GET.searchit }}" placeholder="Search" aria-label="Search"/>
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
{% endblock %}
{% block content %}
    {% load filters %}
    {% load static %}
    <link rel="stylesheet" href="{% static "bookshelf/styles/book_list.css" %}" type="text/css">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <th scope="col">#</th>
                        <th scope="col">Cover</th>
                        <th scope="col">Title</th>
                        <th scope="col">Author</th>
                        <th scope="col">Status</th>
                        {#                        <th scope="col">Shelf</th>#}
                        <th scope="col"></th>
                        </thead>
                        {% for book in object_list %}
                            <tr>
                                <th scope="row">{{ forloop.counter }}</th>
                                <td><img src="{{ book.cover }}" alt=""
                                         style="max-width:8em; cursor:pointer"></td>
                                {% if book.type == 'paperback' %}
                                    <td>
                                        <img
                                                src="https://image.flaticon.com/icons/png/512/166/166088.png"
                                                alt="Paperback"
                                                style="max-width:1.5em"
                                                title="Paperback">
                                        {{ book.title|title }}</td>
                                {% else %}
                                    <td>{{ book.title|title }}</td>
                                {% endif %}
                                <td>{{ book.author.first_name|title }} {{ book.author.last_name|title }}</td>
                                <td style="color:{{ book.status|get_status_color }}">
                                    {{ book.get_status_display }}
                                    {% if book.status == 'A' %}
                                        ({{ book.current_amount }}/{{ book.total_amount }})
                                    {% endif %}
                                </td>
                                {#                                <td>None</td>#}
                                <td>

                                    {#                                Button block                                 #}

                                    {% if request.user|has_group:"Librarian" %}
                                        <div class="btn-group-vertical" role="group" aria-label="Management Panel">
                                            <a type="button" class="btn btn-success"
                                               href="{% url 'book_update' pk=book.pk %}">Edit</a>
                                            <a type="button" class="btn btn-danger"
                                               href="{% url 'book_delete' pk=book.pk %}">Remove</a>

                                            {% if book.current_amount > 0 %}
                                                <a href="{% url 'getcardnumber' book_pk=book.pk type='borrow' %}"
                                                   type="button"
                                                   class="btn btn-info">
                                                Borrow
                                            {% else %}
                                                <a href="{% url 'getcardnumber' book_pk=book.pk type='reserve' %}"
                                                   type="button"
                                                   class="btn btn-info">
                                                Reserve
                                            {% endif %}
                                            </a>
                                            {% if book.current_amount != book.total_amount %}
                                                <a href="{% url 'getcardnumber' book_pk=book.pk type='return' %}"
                                                   type="button" class="btn btn-4">Return</a>
                                            {% else %}
                                                <button type="button" class="btn btn-4 disabled"
                                                        style="cursor:not-allowed;">Return
                                                </button>
                                            {% endif %}
                                            <a type="button" class="btn btn-4"
                                               href="{% url 'borrowers_detail' pk=book.pk %}">See Debtors</a>
                                        </div>
                                        </td>
                                        </tr>
                                    {% endif %}
                        {% empty %}
                            <p>There are no books yet.</p>

                        {% endfor %}


                    </table>
                </div>
            </div>
        </div>
{#    TODO: Remove pagination when filtering    #}
    {% if not filtered %}
        <div class="row my-2">
            <div class="col-sm-12 text-center">
                <div class="pagination d-flex flex-column align-items-center">
            <span class="step-links">
            {% if page_obj.has_previous %}
                <a class="btn btn-outline-success" href="?page=1">&laquo; first</a>
                <a class="btn btn-outline-success" href="?page={{ page_obj.previous_page_number }}">previous</a>
            {% endif %}

                <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

                {% if page_obj.has_next %}
                    <a class="btn btn-outline-success" href="?page={{ page_obj.next_page_number }}">next</a>
                    <a class="btn btn-outline-success" href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
                {% endif %}
            </span>
                </div>
            </div>
        </div>
    {% endif %}


        {% if request.user|has_group:"Librarian" %}
            <div class="row">
                <div class="col-sm-12 text-center">
                    <a type="button" class="btn btn-success" href="{% url 'book_create' %}">Add book</a>
                    {#                    <button type="button" class="btn btn-success">Create new shelf</button>#}
                </div>

            </div>
            </div>
        {% endif %}
{% endblock %}
